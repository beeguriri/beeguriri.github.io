---
layout: default
title: 병행 프로세스
nav_order: 2
parent: os
---



## 📑 병행 프로세스

- 프로세서 하나는 한 번에 프로세스 하나만 실행
- 병행 프로세스 : 운영체제가 프로세서를 빠르게 전환하여 프로세스 여러 개를 동시에 실행하는 것처럼 보이게 함
- 공유 자원을 상호 배타적으로 사용
- 병행 프로세스 간에는 협력이나 동기화가 되어야 함
- 프로세스는 다른 프로세스의 실행 속도와 관계없이 항상 일정한 실행 결과를 보장
- 교착 상태를 해결하여 병렬 처리 능력 극대화 
- 상호 배제 : 어떤 프로세스가 작업을 실행 중일 때 나머지 프로세스는 그것과 관련된 작업 수행할 수 없도록 보장



## 📑 동기화

- `Race Condition` : 두 개 이상의 스레드들이 공유 된 자원에 접근 시 하나의 자원을 놓고 서로 경쟁하려는 상황

### ⭐ 임계 영역

- 공유되는 자원에서 문제가 발생하지 않도록 독점을 보장해 줘야 하는 영역
- 프로세스가 `임계영역 실행 시작` 하면 `임계영역 실행 종료` 까지 방해 받지 않고 수행 하도록 해야 함
- 임계 영역 문제를 해결하기 위한 조건 : `상호 배제 ` `진행` `제한된대기`
  - 상호배제 : 하나의 프로세스가 임계 영역에 들어가 있다면 다른 프로세스는 들어갈 수 없어야 한다.
  - 진행 : 임계 영역에 들어간 프로세스가 없는 상태에서, 들어가려고 하는 프로세스가 여러 개 있다면 어느 것이 들어 갈지 적절히 결정 해주어야 한다.
  - 제한된 대기 : 다른 프로세스의 기아(Starvation)를 방지하기 위해, 한 번 임계 영역에 들어간 프로세스는 다음 번 임계 영역에 들어갈 때 제한을 두어야 한다.



### ⭐ 상호 배제 해결 

- 데커 알고리즘 (N=2)

```c
while(1){
  flag[i] = true;          //프로세스i 임계영역 진입 알림
  while(flag[j]) {        //프로세스j 임계영역 진입 여부 확인
    if(turn==j) {        //프로세스j가 임계영역 내부에 있으면
      flag[i] = false;    //프로세스i의 진입 취소
      while(turn==j);      //프로세스j 수행
      flag[i] = true;      //프로세스i 진입 알림
    }
  }
  //임계영역
  //...

  //임계영역 끝
  turn = j;                //임계구역 사용 후 프로세스j에 차례 넘김
  flag[i] = false;        //프로세스i 임계구역 사용 완료 알림
}
```

- 피터슨 알고리즘 (N=2)

```c
while(1){
  flag[i] = true;          //프로세스i 임계영역 진입 알림
  turn = j;
  while(flag[j] && turn==j){
    //임계영역 사용 가능한지 계속 확인
  };

  //임계영역 시작
  //...

  //임계영역 끝
  flag[i] = false;
}
```

- 빵집 알고리즘 (N>2)
  - 프로세스에 고유 번호 부여, 우선순위 높은 프로세스 먼저 진입
  - 번호가 낮을수록 우선순위가 높음

```c
while(1){
  //우선순위 부여받기
  choosing[i] = true;
  number[i] = max(number[0], number[1], ... , number[n-1]) + 1;
  choosing[i] = false;

  for(j=0; j<n; j++) {
    while(choosing[j]); //j가 우선순위 받을때 까지 대기
    while(number[j]!=0 &&
         	(number[j]<number[i] //프로세스 j가 우선순위가 높거나
            	|| number[j]==number[i] && j<i) //우선순위가 같을 때 j가 i보다 작으면 대기
  }  

  //임계영역 시작
  //...

  //임계영역 끝
  number[i] = 0;
}
```

- TestAndSet 명령어
- 세마포어
  - 세마포어 변수(정수형) S와 P(wait), V(signal) 연산으로 이루어짐
  - 세마포어의 카운트는 1 이상이며
  - 카운트를 조절하여 진입 가능한 프로세스/스레드 수 조절

```c
P(S) : while S<=0 do no-op; //임계구역 진입 가능할때까지 빈 반복문 수행
		S := S-1;
V(S) : S := S+1;
```

- 뮤텍스
  - 동기화 대상이 하나
  - 한 스레드, 프로세스에 의해 소유될 수 있는 키를 기반으로 하는 상호 배제



## 📑 교착 상태

- 다중 프로그래밍 시스템에서 결코 일어나지 않을 사건을 기다리고 있는 프로세스

### ⭐ 교착상태 필요조건

- 상호배제 : 한번에 한 프로세스만이 그 자원을 사용
- 점유와 대기 : 적어도 하나의 자원을 보유하고, 현재 다른 프로세스에 할당 된 자원을 기다림
- 비선점 : 자원을 점유하고 있는 프로세스가 끝나야 자원 해제
- 순환대기 : 각 프로세스는 자신에게 할당된 자원을 가지면서 상대방 프로세스의 자원을 상호 요청



### ⭐ 교착상태 예방

- 점유와 대기 부정
  - 각 프로세스는 한번에 자기가 필요한 모든 자원을 요구해야 함
- 비선점 부정
  - 프로세스는 필요 시 자원 요구, 사용하지 않을 때는 자원 반납
- 순환대기 부정
  - 자원 유형 별로 할당 순서 부여, 순서에 따라 자원 요구



### ⭐ 교착상태 회피

- 은행가 알고리즘
  - 프로세스가 어떤 자원을 요청할 때
  - 이 자원을 할당했을 때 교착 상태가 발생할 수 있다면 자원 할당 하지 않음.

