---
layout: default
title: 트랜잭션
nav_order: 1
parent: DataBase
---



## 📑 트랜잭션

### ⭐ 특징

- `A`tomicity : 트랜잭션 연산은 데이터베이스에 모두 반영되든지(Commit) 전혀 반영 되지 않든지(Rollback)
- `C`onsistency : 트랜잭션 성공 시 언제나 일관성 있는 데이터 베이스 상태로 변환
- `I`solation : 둘 이상의 트랜잭션 동시 병행 실행 되는 경우 독립성, 격리성, 순차성
- `D`urability : 트랜잭션 성공 시 시스템이 고장 나더라도 영구적으로 반영



### ⭐ 2-단계 완료 규약

- 트랜잭션 `원자성` 보장
- 단계 1 의사결정 획득 : 조정자는 모든 참가자에게 트랜잭션의 완료 준비 요청
- 단계 2  의사결정 기록 : 조정자는 모든 참가자에게 트랜잭션 완료 또는 중단 메시지를 보냄
- 분산데이터베이스 시스템에서 사용
- 트랜잭션이 한 사이트에서는 완료되고 다른 사이트에서는 중단 될 수 없음



### ⭐ 2-단계 로킹 규약

- 트랜잭션 `직렬 가능성` 보장
- 확장 : 트랜잭션은 `lock`만 수행할 수 있다
- 수축 : 트랜잭션은 `unlock`만 수행할 수 있다



## 📑 동시성 제어

### ⭐ 갱신 손실

- 하나의 트랜잭션이 갱신한 내용을 `다른 트랜잭션이 덮어씀`으로써 갱신 무효화
- 두개의 트랜잭션이 한 개의 데이터를 동시에 갱신할 때 발생

| T1          | T2          |                |
| ----------- | ----------- | -------------- |
| read(x)     |             |                |
| x = x + 100 |             |                |
|             | read(x)     |                |
|             | x = x + 200 |                |
| write(x)    |             |                |
|             | write(x)    | T1 갱신 무효화 |



### ⭐ 모순성

- 트랜잭션이 어떤 것은 갱신 전의 값을 읽고, 다른 어떤 것은 갱신된 후의 값을 읽게 되어 데이터의 불일치 발생

| T1          | T2        |                     |
| ----------- | --------- | ------------------- |
| read(x)     | read(x)   | 갱신전 데이터 읽음  |
| x = x + 100 | x = x+300 |                     |
| write(x)    | write(x)  |                     |
|             | read(y)   |                     |
|             | y = y+300 |                     |
|             | write(y)  | y값 갱신            |
| read(y)     |           | 갱신 후 데이터 읽음 |
| y = y + 100 |           |                     |
| write(y)    |           |                     |



### ⭐ 연쇄 복귀

- 두 트랜잭션이 동일한 데이터 내용을 접근할 때 발생
- 한 트랜잭션이 데이터를 갱신한 다음 Rollback연산 수행하는 과정에서 발생

| T1          | T2        |                               |
| ----------- | --------- | ----------------------------- |
| read(x)     |           |                               |
| x = x + 100 |           |                               |
| write(x)    |           |                               |
|             | read(x)   | T1 트랜잭션 롤백 전 값을 읽음 |
|             | x = x+300 |                               |
|             | write(x)  | T2 트랜잭션 종료              |
| read(y)     |           |                               |
| rollback T1 |           | T2 트랜잭션 롤백 불가         |



## 📑 독립성 레벨

|                  | Dirty Read | Non Repeatable Read | Phantom Read |
| ---------------- | ---------- | ------------------- | ------------ |
| Read Uncommitted | O          | O                   | O            |
| Read Committed   | X          | O                   | O            |
| Repeatable Read  | X          | X                   | O            |
| Serializable     | X          | X                   | X            |

- Dirty Read : `Rollback`
- Phantom Read : `Insert into`
